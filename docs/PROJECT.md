# FAST 易支付 - 项目说明文档

## 一、项目概述

### 1.1 项目简介

FAST 易支付是一款**个人免签支付平台**，专注于为个人开发者和小型商户提供便捷的收款解决方案。通过普通收款码即可实现收款通知自动回调，无需企业资质，资金直达个人账户。

### 1.2 核心特性

| 特性 | 说明 |
|------|------|
| 🔐 **免签约** | 无需企业资质，个人收款码即可使用 |
| ⚡ **秒到账** | 资金直达个人账户，无需提现 |
| 🔄 **自动回调** | 支付成功自动通知商户系统，支持自动重试 |
| 📱 **多通道** | 支持微信、支付宝等多种支付方式 |
| 🛠️ **易对接** | 提供页面跳转支付和 API 接口两种方式 |
| 🎨 **现代 UI** | 简洁美观的用户界面，响应式设计 |
| 🔔 **实时推送** | WebSocket 实时推送支付结果 |

### 1.3 适用场景

- 个人网站收款
- 小型电商平台
- 知识付费系统
- 会员充值系统
- 虚拟商品交易
- 捐赠打赏系统

---

## 二、系统架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                          FAST 易支付系统                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│   ┌──────────────┐   ┌──────────────┐   ┌──────────────────────┐   │
│   │   管理后台    │   │   商户平台    │   │      支付页面         │   │
│   │   (Admin)    │   │  (Merchant)  │   │     (Pay Page)       │   │
│   │  Port: 3001  │   │  Port: 3002  │   │                      │   │
│   │              │   │              │   │  ┌────────────────┐  │   │
│   │  - 商户管理   │   │  - 店铺管理   │   │  │  收款二维码    │  │   │
│   │  - 店铺管理   │   │  - 通道管理   │   │  │  支付状态展示  │  │   │
│   │  - 订单管理   │   │  - 订单管理   │   │  │  WebSocket    │  │   │
│   │  - 数据统计   │   │  - 开发文档   │   │  └────────────────┘  │   │
│   └──────┬───────┘   └──────┬───────┘   └──────────┬───────────┘   │
│          │                  │                       │               │
│          └──────────────────┼───────────────────────┘               │
│                             │                                        │
│                      ┌──────▼──────┐                                │
│                      │   后端服务   │                                │
│                      │  (Server)   │                                │
│                      │  Port: 9090 │                                │
│                      │             │                                │
│                      │  Spring Boot 3.2                             │
│                      │  + MyBatis Plus                              │
│                      │  + WebSocket                                 │
│                      │  + JWT 认证                                  │
│                      └──────┬──────┘                                │
│                             │                                        │
│                      ┌──────▼──────┐                                │
│                      │   MySQL     │                                │
│                      │  Database   │                                │
│                      │   8.0+      │                                │
│                      └─────────────┘                                │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 支付流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│  商户   │     │ 支付网关 │     │ 支付页面 │     │  用户   │     │ 商户系统 │
└────┬────┘     └────┬────┘     └────┬────┘     └────┬────┘     └────┬────┘
     │               │               │               │               │
     │ 1.创建订单    │               │               │               │
     │──────────────>│               │               │               │
     │               │               │               │               │
     │ 2.返回支付URL │               │               │               │
     │<──────────────│               │               │               │
     │               │               │               │               │
     │ 3.跳转支付页面│               │               │               │
     │───────────────────────────────>               │               │
     │               │               │               │               │
     │               │               │ 4.展示二维码  │               │
     │               │               │──────────────>│               │
     │               │               │               │               │
     │               │               │ 5.扫码支付    │               │
     │               │               │<──────────────│               │
     │               │               │               │               │
     │               │ 6.收到支付通知│               │               │
     │               │<──────────────│               │               │
     │               │               │               │               │
     │               │ 7.WebSocket推送支付结果       │               │
     │               │──────────────>│               │               │
     │               │               │               │               │
     │               │ 8.回调通知    │               │               │
     │               │───────────────────────────────────────────────>
     │               │               │               │               │
     │               │               │ 9.跳转结果页  │               │
     │               │               │──────────────>│               │
     │               │               │               │               │
```

---

## 三、项目结构

### 3.1 目录结构

```
bigbear-pay/
├── docs/                        # 项目文档
│   ├── PROJECT.md              # 项目说明文档
│   ├── USER_GUIDE.md           # 使用说明文档
│   └── DEMO.md                 # Demo 说明文档
│
├── fastpay-server/              # 后端服务 (Spring Boot 3.2)
│   ├── src/main/java/com/fastpay/
│   │   ├── common/              # 通用类
│   │   │   ├── Result.java      # 统一响应结果
│   │   │   ├── PageResult.java  # 分页结果
│   │   │   ├── Constants.java   # 常量定义
│   │   │   └── BusinessException.java  # 业务异常
│   │   │
│   │   ├── config/              # 配置类
│   │   │   ├── WebConfig.java   # Web 配置（跨域）
│   │   │   ├── MybatisPlusConfig.java  # MyBatis Plus 配置
│   │   │   ├── JwtConfig.java   # JWT 配置
│   │   │   ├── WebSocketConfig.java    # WebSocket 配置
│   │   │   └── AsyncConfig.java # 异步线程池配置
│   │   │
│   │   ├── controller/          # 控制器
│   │   │   ├── admin/           # 管理后台接口
│   │   │   │   ├── AdminAuthController.java     # 管理员认证
│   │   │   │   ├── AdminMerchantController.java # 商户管理
│   │   │   │   ├── AdminShopController.java     # 店铺管理
│   │   │   │   ├── AdminOrderController.java    # 订单管理
│   │   │   │   └── AdminDashboardController.java # 控制台统计
│   │   │   │
│   │   │   ├── merchant/        # 商户平台接口
│   │   │   │   ├── MerchantAuthController.java  # 商户认证
│   │   │   │   ├── MerchantShopController.java  # 店铺管理
│   │   │   │   ├── MerchantOrderController.java # 订单管理
│   │   │   │   └── MerchantChannelController.java # 通道管理
│   │   │   │
│   │   │   ├── pay/             # 支付接口
│   │   │   │   └── PayController.java  # 支付核心接口
│   │   │   │
│   │   │   └── notify/          # 回调接口
│   │   │       └── NotifyController.java  # 支付回调处理
│   │   │
│   │   ├── dto/                 # 数据传输对象
│   │   │   ├── CreateOrderDTO.java    # 创建订单请求
│   │   │   └── PayNotifyDTO.java      # 支付通知
│   │   │
│   │   ├── entity/              # 实体类
│   │   │   ├── Merchant.java    # 商户
│   │   │   ├── Shop.java        # 店铺
│   │   │   ├── MerchantChannel.java  # 商户通道
│   │   │   ├── PayQrcode.java   # 收款二维码
│   │   │   ├── PayOrder.java    # 支付订单
│   │   │   └── AdminUser.java   # 管理员
│   │   │
│   │   ├── mapper/              # MyBatis Mapper
│   │   ├── service/             # 服务层
│   │   │   ├── impl/            # 服务实现
│   │   │   └── ...              # 服务接口
│   │   │
│   │   ├── task/                # 定时任务
│   │   │   └── NotifyRetryTask.java  # 回调重试任务
│   │   │
│   │   ├── util/                # 工具类
│   │   │   ├── SignUtil.java    # 签名工具
│   │   │   ├── JwtUtil.java     # JWT 工具
│   │   │   └── HttpUtil.java    # HTTP 工具
│   │   │
│   │   ├── vo/                  # 视图对象
│   │   │   └── PayResultVO.java # 支付结果
│   │   │
│   │   └── websocket/           # WebSocket
│   │       └── PayWebSocketHandler.java  # 支付结果推送
│   │
│   └── src/main/resources/
│       ├── db/                  # 数据库脚本
│       │   └── init.sql         # 初始化脚本
│       └── application.yml      # 配置文件
│
├── fastpay-admin/               # 管理后台 (Vue3 + Element Plus)
│   ├── src/
│   │   ├── api/                 # API 接口封装
│   │   │   └── index.js         # 接口定义
│   │   ├── assets/              # 静态资源
│   │   ├── layout/              # 布局组件
│   │   │   └── index.vue        # 主布局
│   │   ├── router/              # 路由配置
│   │   │   └── index.js         # 路由定义
│   │   ├── utils/               # 工具函数
│   │   │   └── request.js       # Axios 封装
│   │   └── views/               # 页面组件
│   │       ├── dashboard/       # 控制台
│   │       ├── merchant/        # 商户管理
│   │       ├── shop/            # 店铺管理
│   │       ├── channel/         # 通道管理
│   │       ├── order/           # 订单管理
│   │       └── login/           # 登录页
│   └── public/                  # 公共资源
│
├── fastpay-merchant/            # 商户平台 (Vue3 + Element Plus)
│   ├── src/
│   │   ├── api/                 # API 接口封装
│   │   ├── assets/              # 静态资源
│   │   ├── layout/              # 布局组件
│   │   ├── router/              # 路由配置
│   │   ├── utils/               # 工具函数
│   │   └── views/               # 页面组件
│   │       ├── dashboard/       # 控制台
│   │       ├── shop/            # 店铺管理
│   │       ├── channel/         # 通道管理
│   │       ├── qrcode/          # 二维码管理
│   │       ├── order/           # 订单管理
│   │       ├── config/          # 开发配置
│   │       ├── docs/            # 开发文档
│   │       └── pay/             # 支付页面
│   └── public/                  # 公共资源
│
├── fastpay-demo/                # 对接演示项目 (Spring Boot)
│   ├── src/main/java/com/fastpay/demo/
│   │   ├── config/              # 配置类
│   │   ├── controller/          # 控制器
│   │   ├── service/             # 服务层
│   │   └── util/                # 工具类
│   └── src/main/resources/
│       ├── templates/           # Thymeleaf 模板
│       └── application.yml      # 配置文件
│
└── README.md                    # 项目说明
```

---

## 四、技术栈

### 4.1 后端技术

| 技术 | 版本 | 说明 |
|------|------|------|
| Java | 17 | 开发语言 |
| Spring Boot | 3.2.0 | 基础框架 |
| MyBatis Plus | 3.5.5 | ORM 框架，简化数据库操作 |
| MySQL | 8.0+ | 关系型数据库 |
| JWT | - | 无状态身份认证 |
| WebSocket | - | 支付结果实时推送 |
| Hutool | 5.8+ | Java 工具类库 |
| Lombok | - | 简化代码 |

### 4.2 前端技术

| 技术 | 版本 | 说明 |
|------|------|------|
| Vue | 3.4+ | 前端框架 |
| Element Plus | 2.4+ | UI 组件库 |
| Vue Router | 4.x | 路由管理 |
| Axios | - | HTTP 请求库 |
| Vite | 5.x | 构建工具 |
| qrcode | - | 二维码生成 |
| jsQR | - | 二维码解析 |

### 4.3 开发工具

| 工具 | 说明 |
|------|------|
| Maven | 后端依赖管理 |
| npm/pnpm | 前端依赖管理 |
| Git | 版本控制 |

---

## 五、数据库设计

### 5.1 核心表结构

#### 商户表 (merchant)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| merchant_no | VARCHAR(32) | 商户编号（唯一） |
| merchant_name | VARCHAR(100) | 商户名称 |
| username | VARCHAR(50) | 登录用户名 |
| password | VARCHAR(100) | 登录密码（加密） |
| api_secret | VARCHAR(64) | API 密钥 |
| notify_url | VARCHAR(255) | 默认回调地址 |
| status | TINYINT | 状态：0-禁用，1-启用 |
| create_time | DATETIME | 创建时间 |

#### 店铺表 (shop)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| merchant_id | BIGINT | 所属商户 |
| shop_no | VARCHAR(32) | 店铺编号 |
| shop_name | VARCHAR(100) | 店铺名称 |
| status | TINYINT | 状态 |
| total_amount | DECIMAL | 累计交易额 |

#### 支付订单表 (pay_order)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| order_no | VARCHAR(32) | 平台订单号 |
| out_trade_no | VARCHAR(64) | 商户订单号 |
| merchant_id | BIGINT | 商户ID |
| shop_id | BIGINT | 店铺ID |
| amount | DECIMAL | 订单金额 |
| pay_amount | DECIMAL | 实付金额 |
| pay_type | VARCHAR(20) | 支付类型 |
| status | TINYINT | 状态：0-待支付，1-已支付，2-已过期，3-已关闭 |
| notify_url | VARCHAR(255) | 回调地址 |
| return_url | VARCHAR(255) | 跳转地址 |
| notify_status | TINYINT | 回调状态：0-未通知，1-成功，2-失败 |
| notify_count | INT | 回调次数 |
| pay_time | DATETIME | 支付时间 |
| create_time | DATETIME | 创建时间 |

---

## 六、核心功能

### 6.1 支付方式

| 方式 | 说明 | 适用场景 |
|------|------|------|
| 页面跳转支付 | 表单提交跳转到支付页面 | 网站接入 |
| API 接口支付 | 后端调用获取二维码 | APP、自定义页面 |

### 6.2 回调通知

- **自动回调**：支付成功后自动通知商户系统
- **自动重试**：失败后自动重试，最多 5 次
- **递增间隔**：重试间隔递增（1分钟、2分钟、4分钟、8分钟、16分钟）
- **手动重发**：支持手动触发重发通知

### 6.3 实时推送

- 使用 WebSocket 实现支付结果实时推送
- 用户支付成功后，页面立即收到通知并跳转

---

## 七、安全设计

### 7.1 签名机制

- 所有 API 请求需携带签名
- 签名算法：参数排序 + MD5 加密
- 防止请求篡改和重放攻击

### 7.2 身份认证

- 使用 JWT Token 进行身份认证
- Token 有效期可配置
- 支持 Token 刷新

### 7.3 数据安全

- 密码使用 BCrypt 加密存储
- API 密钥随机生成
- 敏感信息脱敏展示

---

## 八、性能优化

### 8.1 异步处理

- 回调通知异步发送，不阻塞主流程
- WebSocket 通知使用独立线程池
- 自定义线程池，根据 CPU 和内存动态配置

### 8.2 数据库优化

- 合理使用索引
- 分页查询避免全表扫描
- 批量操作减少数据库连接

---

## 九、部署架构

### 9.1 单机部署

适用于小规模使用：

```
┌─────────────────────────────────┐
│           单台服务器             │
│  ┌─────────────────────────┐   │
│  │  Nginx (反向代理)        │   │
│  └───────────┬─────────────┘   │
│              │                  │
│  ┌───────────▼─────────────┐   │
│  │  Spring Boot (9090)     │   │
│  └───────────┬─────────────┘   │
│              │                  │
│  ┌───────────▼─────────────┐   │
│  │  MySQL (3306)           │   │
│  └─────────────────────────┘   │
└─────────────────────────────────┘
```

### 9.2 分布式部署

适用于大规模使用：

```
┌─────────────────────────────────────────────────┐
│                   负载均衡                       │
│                  (Nginx/SLB)                    │
└───────────────────┬─────────────────────────────┘
                    │
        ┌───────────┼───────────┐
        │           │           │
┌───────▼───┐ ┌─────▼─────┐ ┌───▼───────┐
│  Server1  │ │  Server2  │ │  Server3  │
│  (9090)   │ │  (9090)   │ │  (9090)   │
└─────┬─────┘ └─────┬─────┘ └─────┬─────┘
      │             │             │
      └─────────────┼─────────────┘
                    │
            ┌───────▼───────┐
            │  MySQL 主从   │
            │  (读写分离)   │
            └───────────────┘
```

---

## 十、版本历史

### v1.0.0 (2025-01)

- 初始版本发布
- 支持微信、支付宝收款
- 页面跳转支付和 API 接口支付
- 管理后台和商户平台
- WebSocket 实时支付结果推送
- 回调通知自动重试机制

---

## 十一、开发团队

**大熊 Bigbear**

---

## 十二、许可证

MIT License
